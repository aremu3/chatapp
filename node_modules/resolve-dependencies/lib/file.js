"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFile = exports.ensureDottedRelative = exports.isNodeModule = exports.nodeModuleGlobs = exports.extraGlobs = exports.hasModuleGlobs = exports.isScript = void 0;
const path_1 = require("path");
const esmRegex = /(^\s*|[}\);\n]\s*)(import\s*(['"]|(\*\s+as\s+)?(?!type)([^"'\(\)\n; ]+)\s*from\s*['"]|\{)|export\s+\*\s+from\s+["']|export\s*(\{|default|function|class|var|const|let|async\s+function))/, moduleGlob = ['**/*', '!node_modules', '!test', '!**/*.d.ts'];
function isScript(code) {
    return !Boolean(code.match(esmRegex));
}
exports.isScript = isScript;
function hasModuleGlobs(file) {
    return nodeModuleGlobs(file) !== moduleGlob;
}
exports.hasModuleGlobs = hasModuleGlobs;
function extraGlobs(file) {
    var _a, _b, _c, _d;
    const globs = [];
    return globs
        .concat(...[((_b = (_a = file.package) === null || _a === void 0 ? void 0 : _a.pkg) === null || _b === void 0 ? void 0 : _b.scripts) || []])
        .concat(...[((_d = (_c = file.package) === null || _c === void 0 ? void 0 : _c.pkg) === null || _d === void 0 ? void 0 : _d.assets) || []]);
}
exports.extraGlobs = extraGlobs;
function nodeModuleGlobs(file, useDefault = true) {
    var _a;
    const normalGlobs = [].concat(...(((_a = file.package) === null || _a === void 0 ? void 0 : _a.files) || []));
    if (useDefault && !normalGlobs.length) {
        return moduleGlob;
    }
    return normalGlobs;
}
exports.nodeModuleGlobs = nodeModuleGlobs;
const notNodeModule = /^\.|^\//;
function isNodeModule(request) {
    return !notNodeModule.test(request);
}
exports.isNodeModule = isNodeModule;
function ensureDottedRelative(from, to) {
    let rel = path_1.relative(from, to);
    if (!rel.startsWith('.' + path_1.sep)) {
        rel = './' + rel;
    }
    return rel.split(path_1.sep).join('/');
}
exports.ensureDottedRelative = ensureDottedRelative;
function createFile(absPath) {
    return {
        size: 0,
        deps: {},
        absPath,
        contents: null,
        variableImports: false,
    };
}
exports.createFile = createFile;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9maWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtCQUFvQztBQUVwQyxNQUFNLFFBQVEsR0FBRywwTEFBMEwsRUFDek0sVUFBVSxHQUFHLENBQUMsTUFBTSxFQUFFLGVBQWUsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUE7QUFFL0QsU0FBZ0IsUUFBUSxDQUFDLElBQVk7SUFDbkMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUE7QUFDdkMsQ0FBQztBQUZELDRCQUVDO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLElBQXlDO0lBQ3RFLE9BQU8sZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLFVBQVUsQ0FBQTtBQUM3QyxDQUFDO0FBRkQsd0NBRUM7QUFFRCxTQUFnQixVQUFVLENBQUMsSUFBeUM7O0lBQ2xFLE1BQU0sS0FBSyxHQUFhLEVBQUUsQ0FBQTtJQUMxQixPQUFPLEtBQUs7U0FDVCxNQUFNLENBQUMsR0FBRyxDQUFDLGFBQUEsSUFBSSxDQUFDLE9BQU8sMENBQUUsR0FBRywwQ0FBRSxPQUFPLEtBQUksRUFBRSxDQUFDLENBQUM7U0FDN0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFBLElBQUksQ0FBQyxPQUFPLDBDQUFFLEdBQUcsMENBQUUsTUFBTSxLQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7QUFDakQsQ0FBQztBQUxELGdDQUtDO0FBRUQsU0FBZ0IsZUFBZSxDQUM3QixJQUF5QyxFQUN6QyxVQUFVLEdBQUcsSUFBSTs7SUFFakIsTUFBTSxXQUFXLEdBQWEsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBQSxJQUFJLENBQUMsT0FBTywwQ0FBRSxLQUFLLEtBQUksRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUN2RSxJQUFJLFVBQVUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUU7UUFDckMsT0FBTyxVQUFVLENBQUE7S0FDbEI7SUFDRCxPQUFPLFdBQVcsQ0FBQTtBQUNwQixDQUFDO0FBVEQsMENBU0M7QUE4QkQsTUFBTSxhQUFhLEdBQUcsU0FBUyxDQUFBO0FBRS9CLFNBQWdCLFlBQVksQ0FBQyxPQUFlO0lBQzFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ3JDLENBQUM7QUFGRCxvQ0FFQztBQUVELFNBQWdCLG9CQUFvQixDQUFDLElBQVksRUFBRSxFQUFVO0lBQzNELElBQUksR0FBRyxHQUFHLGVBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDNUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLFVBQUcsQ0FBQyxFQUFFO1FBQzlCLEdBQUcsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFBO0tBQ2pCO0lBQ0QsT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUNqQyxDQUFDO0FBTkQsb0RBTUM7QUFFRCxTQUFnQixVQUFVLENBQUMsT0FBZTtJQUN4QyxPQUFPO1FBQ0wsSUFBSSxFQUFFLENBQUM7UUFDUCxJQUFJLEVBQUUsRUFBRTtRQUNSLE9BQU87UUFDUCxRQUFRLEVBQUUsSUFBSTtRQUNkLGVBQWUsRUFBRSxLQUFLO0tBQ3ZCLENBQUE7QUFDSCxDQUFDO0FBUkQsZ0NBUUMifQ==